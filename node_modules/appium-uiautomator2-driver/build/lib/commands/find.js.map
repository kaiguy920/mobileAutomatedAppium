{"version":3,"file":"find.js","names":["helpers","MAGIC_FIRST_VIS_CHILD_SEL","MAGIC_SCROLLABLE_SEL","MAGIC_SCROLLABLE_BY","doFindElementOrEls","params","strategy","test","selector","elementId","context","uiautomator2","jwproxy","command","CssConverter","opts","appPackage","toUiAutomatorSelector","multiple"],"sources":["../../../lib/commands/find.js"],"sourcesContent":["import CssConverter from '../css-converter';\n\nconst helpers = {};\n\n// we override the xpath search for this first-visible-child selector, which\n// looks like /*[@firstVisible=\"true\"]\nconst MAGIC_FIRST_VIS_CHILD_SEL = /\\/\\*\\[@firstVisible ?= ?('|\")true\\1\\]/;\n\nconst MAGIC_SCROLLABLE_SEL = /\\/\\/\\*\\[@scrollable ?= ?('|\")true\\1\\]/;\nconst MAGIC_SCROLLABLE_BY = 'new UiSelector().scrollable(true)';\n\n/**\n * Overriding helpers.doFindElementOrEls functionality of appium-android-driver,\n * this.element initialized in find.js of appium-android-drive.\n */\nhelpers.doFindElementOrEls = async function (params) {\n  if (params.strategy === 'xpath' && MAGIC_FIRST_VIS_CHILD_SEL.test(params.selector)) {\n    let elementId = params.context;\n    return await this.uiautomator2.jwproxy.command(`/appium/element/${elementId}/first_visible`, 'GET', {});\n  }\n  if (params.strategy === 'xpath' && MAGIC_SCROLLABLE_SEL.test(params.selector)) {\n    params.strategy = '-android uiautomator';\n    params.selector = MAGIC_SCROLLABLE_BY;\n  }\n  if (params.strategy === 'css selector') {\n    params.strategy = '-android uiautomator';\n    params.selector = new CssConverter(params.selector, this.opts.appPackage)\n      .toUiAutomatorSelector();\n  }\n  return await this.uiautomator2.jwproxy.command(`/element${params.multiple ? 's' : ''}`, 'POST', params);\n};\n\nexport { helpers };\nexport default helpers;\n"],"mappings":";;;;;;;;;;;AAAA;;AAEA,MAAMA,OAAO,GAAG,EAAhB;;AAIA,MAAMC,yBAAyB,GAAG,uCAAlC;AAEA,MAAMC,oBAAoB,GAAG,uCAA7B;AACA,MAAMC,mBAAmB,GAAG,mCAA5B;;AAMAH,OAAO,CAACI,kBAAR,GAA6B,gBAAgBC,MAAhB,EAAwB;EACnD,IAAIA,MAAM,CAACC,QAAP,KAAoB,OAApB,IAA+BL,yBAAyB,CAACM,IAA1B,CAA+BF,MAAM,CAACG,QAAtC,CAAnC,EAAoF;IAClF,IAAIC,SAAS,GAAGJ,MAAM,CAACK,OAAvB;IACA,OAAO,MAAM,KAAKC,YAAL,CAAkBC,OAAlB,CAA0BC,OAA1B,CAAmC,mBAAkBJ,SAAU,gBAA/D,EAAgF,KAAhF,EAAuF,EAAvF,CAAb;EACD;;EACD,IAAIJ,MAAM,CAACC,QAAP,KAAoB,OAApB,IAA+BJ,oBAAoB,CAACK,IAArB,CAA0BF,MAAM,CAACG,QAAjC,CAAnC,EAA+E;IAC7EH,MAAM,CAACC,QAAP,GAAkB,sBAAlB;IACAD,MAAM,CAACG,QAAP,GAAkBL,mBAAlB;EACD;;EACD,IAAIE,MAAM,CAACC,QAAP,KAAoB,cAAxB,EAAwC;IACtCD,MAAM,CAACC,QAAP,GAAkB,sBAAlB;IACAD,MAAM,CAACG,QAAP,GAAkB,IAAIM,qBAAJ,CAAiBT,MAAM,CAACG,QAAxB,EAAkC,KAAKO,IAAL,CAAUC,UAA5C,EACfC,qBADe,EAAlB;EAED;;EACD,OAAO,MAAM,KAAKN,YAAL,CAAkBC,OAAlB,CAA0BC,OAA1B,CAAmC,WAAUR,MAAM,CAACa,QAAP,GAAkB,GAAlB,GAAwB,EAAG,EAAxE,EAA2E,MAA3E,EAAmFb,MAAnF,CAAb;AACD,CAfD;;eAkBeL,O"}