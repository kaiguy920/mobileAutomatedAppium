{"version":3,"file":"viewport.js","names":["extensions","commands","getStatusBarHeight","statusBar","uiautomator2","jwproxy","command","getDevicePixelRatio","getViewportScreenshot","screenshot","getScreenshot","rect","getViewPortRect","imageUtil","cropBase64Image","windowSize","getWindowSize","statusBarHeight","left","top","width","height","Object","assign"],"sources":["../../../lib/commands/viewport.js"],"sourcesContent":["import { imageUtil } from 'appium/support';\n\n\nlet extensions = {}, commands = {};\n\n// memoized in constructor\ncommands.getStatusBarHeight = async function () {\n  const {statusBar} = await this.uiautomator2.jwproxy.command(`/appium/device/system_bars`, 'GET', {});\n  return statusBar;\n};\n\n// memoized in constructor\ncommands.getDevicePixelRatio = async function () {\n  return await this.uiautomator2.jwproxy.command('/appium/device/pixel_ratio', 'GET', {});\n};\n\ncommands.getViewportScreenshot = async function () {\n  const screenshot = await this.getScreenshot();\n  const rect = await this.getViewPortRect();\n  return await imageUtil.cropBase64Image(screenshot, rect);\n};\n\ncommands.getViewPortRect = async function () {\n  const windowSize = await this.getWindowSize();\n  const statusBarHeight = await this.getStatusBarHeight();\n  // android returns the upscaled window size, so to get the true size of the\n  // rect we have to downscale\n  return {\n    left: 0,\n    top: statusBarHeight,\n    width: windowSize.width,\n    height: windowSize.height - statusBarHeight\n  };\n};\n\nObject.assign(extensions, commands);\nexport { commands };\nexport default extensions;\n"],"mappings":";;;;;;;;;AAAA;;AAGA,IAAIA,UAAU,GAAG,EAAjB;AAAA,IAAqBC,QAAQ,GAAG,EAAhC;;;AAGAA,QAAQ,CAACC,kBAAT,GAA8B,kBAAkB;EAC9C,MAAM;IAACC;EAAD,IAAc,MAAM,KAAKC,YAAL,CAAkBC,OAAlB,CAA0BC,OAA1B,CAAmC,4BAAnC,EAAgE,KAAhE,EAAuE,EAAvE,CAA1B;EACA,OAAOH,SAAP;AACD,CAHD;;AAMAF,QAAQ,CAACM,mBAAT,GAA+B,kBAAkB;EAC/C,OAAO,MAAM,KAAKH,YAAL,CAAkBC,OAAlB,CAA0BC,OAA1B,CAAkC,4BAAlC,EAAgE,KAAhE,EAAuE,EAAvE,CAAb;AACD,CAFD;;AAIAL,QAAQ,CAACO,qBAAT,GAAiC,kBAAkB;EACjD,MAAMC,UAAU,GAAG,MAAM,KAAKC,aAAL,EAAzB;EACA,MAAMC,IAAI,GAAG,MAAM,KAAKC,eAAL,EAAnB;EACA,OAAO,MAAMC,kBAAA,CAAUC,eAAV,CAA0BL,UAA1B,EAAsCE,IAAtC,CAAb;AACD,CAJD;;AAMAV,QAAQ,CAACW,eAAT,GAA2B,kBAAkB;EAC3C,MAAMG,UAAU,GAAG,MAAM,KAAKC,aAAL,EAAzB;EACA,MAAMC,eAAe,GAAG,MAAM,KAAKf,kBAAL,EAA9B;EAGA,OAAO;IACLgB,IAAI,EAAE,CADD;IAELC,GAAG,EAAEF,eAFA;IAGLG,KAAK,EAAEL,UAAU,CAACK,KAHb;IAILC,MAAM,EAAEN,UAAU,CAACM,MAAX,GAAoBJ;EAJvB,CAAP;AAMD,CAXD;;AAaAK,MAAM,CAACC,MAAP,CAAcvB,UAAd,EAA0BC,QAA1B;eAEeD,U"}