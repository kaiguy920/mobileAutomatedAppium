{"version":3,"file":"element.js","names":["commands","helpers","extensions","toBool","s","_","isString","toLowerCase","active","uiautomator2","jwproxy","command","getAttribute","attribute","elementId","elementDisplayed","elementEnabled","elementSelected","getName","getLocation","getSize","touchLongClick","element","x","y","duration","params","touchDown","touchUp","touchMove","doSetElementValue","setValueImmediate","keys","text","isArray","join","replace","unicodeKeyboard","opts","getText","click","getElementScreenshot","tap","count","areCoordinatesDefined","util","hasValue","Error","i","W3C_ELEMENT_KEY","clear","getElementRect","isWebContext","log","debug","chromedriver","downstreamProtocol","PROTOCOLS","MJSONWP","width","height","Object","assign"],"sources":["../../../lib/commands/element.js"],"sourcesContent":["import _ from 'lodash';\nimport { util } from 'appium/support';\nimport { PROTOCOLS, W3C_ELEMENT_KEY } from 'appium/driver';\n\nlet commands = {}, helpers = {}, extensions = {};\n\nfunction toBool (s) {\n  return _.isString(s) ? (s.toLowerCase() === 'true') : !!s;\n}\n\ncommands.active = async function active () {\n  return await this.uiautomator2.jwproxy.command('/element/active', 'GET');\n};\n\ncommands.getAttribute = async function (attribute, elementId) {\n  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/attribute/${attribute}`, 'GET', {});\n};\n\ncommands.elementDisplayed = async function (elementId) {\n  return toBool(await this.getAttribute('displayed', elementId));\n};\n\ncommands.elementEnabled = async function (elementId) {\n  return toBool(await this.getAttribute('enabled', elementId));\n};\n\ncommands.elementSelected = async function (elementId) {\n  return toBool(await this.getAttribute('selected', elementId));\n};\n\ncommands.getName = async function (elementId) {\n  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/name`, 'GET', {});\n};\n\ncommands.getLocation = async function (elementId) {\n  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/location`, 'GET', {});\n};\n\ncommands.getSize = async function (elementId) {\n  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/size`, 'GET', {});\n};\n\ncommands.touchLongClick = async function (element, x, y, duration) {\n  let params = {element, x, y, duration};\n  return await this.uiautomator2.jwproxy.command(`/touch/longclick`, 'POST', {params});\n};\n\ncommands.touchDown = async function (element, x, y) {\n  let params = {element, x, y};\n  return await this.uiautomator2.jwproxy.command(`/touch/down`, 'POST', {params});\n};\n\ncommands.touchUp = async function (element, x, y) {\n  let params = {element, x, y};\n  return await this.uiautomator2.jwproxy.command(`/touch/up`, 'POST', {params});\n};\n\ncommands.touchMove = async function (element, x, y) {\n  let params = {element, x, y};\n  return await this.uiautomator2.jwproxy.command(`/touch/move`, 'POST', {params});\n};\n\nhelpers.doSetElementValue = async function (params) {\n  return await this.uiautomator2.jwproxy.command(`/element/${params.elementId}/value`, 'POST', params);\n};\n\ncommands.setValueImmediate = async function (keys, elementId) {\n  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/value`, 'POST', {\n    elementId,\n    text: _.isArray(keys) ? keys.join('') : keys,\n    replace: false,\n    unicodeKeyboard: this.opts.unicodeKeyboard,\n  });\n};\n\ncommands.getText = async function (elementId) {\n  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/text`, 'GET', {});\n};\n\ncommands.click = async function (element) {\n  return await this.uiautomator2.jwproxy.command(`/element/${element}/click`, 'POST', {element});\n};\n\ncommands.getElementScreenshot = async function (element) {\n  return await this.uiautomator2.jwproxy.command(`/element/${element}/screenshot`, 'GET', {});\n};\n\ncommands.tap = async function (elementId = null, x = null, y = null, count = 1) {\n  const areCoordinatesDefined = util.hasValue(x) && util.hasValue(y);\n  if (!util.hasValue(elementId) && !areCoordinatesDefined) {\n    throw new Error(`Either element id to tap or both absolute coordinates should be defined`);\n  }\n\n  for (let i = 0; i < count; i++) {\n    if (util.hasValue(elementId) && !areCoordinatesDefined) {\n      // we are either tapping on the default location of the element\n      // or an offset from the top left corner\n      await this.uiautomator2.jwproxy.command(`/element/${elementId}/click`, 'POST');\n    } else {\n      await this.uiautomator2.jwproxy.command(`/appium/tap`, 'POST', {\n        x, y,\n        [W3C_ELEMENT_KEY]: elementId,\n      });\n    }\n  }\n};\n\ncommands.clear = async function (elementId) {\n  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/clear`, 'POST', {elementId});\n};\n\ncommands.getElementRect = async function (elementId) {\n  if (this.isWebContext()) {\n    this.log.debug(`Detected downstream chromedriver protocol: ${this.chromedriver.jwproxy.downstreamProtocol}`);\n    if (this.chromedriver.jwproxy.downstreamProtocol === PROTOCOLS.MJSONWP) {\n      const {x, y} = await this.chromedriver.jwproxy.command(`/element/${elementId}/location`, 'GET');\n      const {width, height} = await this.chromedriver.jwproxy.command(`/element/${elementId}/size`, 'GET');\n      return {x, y, width, height};\n    }\n    return await this.chromedriver.jwproxy.command(`/element/${elementId}/rect`, 'GET');\n  }\n  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/rect`, 'GET');\n};\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers };\nexport default extensions;\n"],"mappings":"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"}