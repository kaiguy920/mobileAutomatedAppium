{"version":3,"file":"helpers.js","names":["helpers","ensureInternetPermissionForApp","adb","app","has","hasInternetPermissionFromManifest","msg","Error","isWriteable","filePath","fs","access","W_OK","system","isWindows","close","open","ign","signApp","appPath","path","dirname","sign"],"sources":["../../lib/helpers.js"],"sourcesContent":["import path from 'path';\nimport { fs, system } from 'appium/support';\n\n\nlet helpers = {};\n\nhelpers.ensureInternetPermissionForApp = async function (adb, app) {\n  let has = await adb.hasInternetPermissionFromManifest(app);\n  if (has) {\n    return;\n  }\n  let msg = 'Your apk does not have INTERNET permissions. Uiautomator2 needs ' +\n            'the internet permission to proceed. Please check if you have ' +\n            '<uses-permission android:name=\"android.**permission.INTERNET\"/>' +\n            'in your AndroidManifest.xml';\n  throw new Error(msg);\n};\n\nhelpers.isWriteable = async function isWriteable (filePath) {\n  try {\n    await fs.access(filePath, fs.W_OK);\n    if (system.isWindows()) {\n      // On operating systems, where access-control policies may\n      // limit access to the file system, `fs.access` does not work\n      // as expected. See https://groups.google.com/forum/#!topic/nodejs/qmZtIwDRSYo\n      // for more details\n      await fs.close(await fs.open(filePath, 'r+'));\n    }\n    return true;\n  } catch (ign) {\n    return false;\n  }\n};\n\nhelpers.signApp = async function (adb, appPath) {\n  if (!await this.isWriteable(appPath)) {\n    throw new Error(`The application at '${appPath}' is not writeable. ` +\n      `Please grant write permissions to this file or to its parent folder '${path.dirname(appPath)}' ` +\n      `for the Appium process, so it could sign the application`);\n  }\n  await adb.sign(appPath);\n};\n\nexport default helpers;\n"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AAGA,IAAIA,OAAO,GAAG,EAAd;;AAEAA,OAAO,CAACC,8BAAR,GAAyC,gBAAgBC,GAAhB,EAAqBC,GAArB,EAA0B;EACjE,IAAIC,GAAG,GAAG,MAAMF,GAAG,CAACG,iCAAJ,CAAsCF,GAAtC,CAAhB;;EACA,IAAIC,GAAJ,EAAS;IACP;EACD;;EACD,IAAIE,GAAG,GAAG,qEACA,+DADA,GAEA,iEAFA,GAGA,6BAHV;EAIA,MAAM,IAAIC,KAAJ,CAAUD,GAAV,CAAN;AACD,CAVD;;AAYAN,OAAO,CAACQ,WAAR,GAAsB,eAAeA,WAAf,CAA4BC,QAA5B,EAAsC;EAC1D,IAAI;IACF,MAAMC,WAAA,CAAGC,MAAH,CAAUF,QAAV,EAAoBC,WAAA,CAAGE,IAAvB,CAAN;;IACA,IAAIC,eAAA,CAAOC,SAAP,EAAJ,EAAwB;MAKtB,MAAMJ,WAAA,CAAGK,KAAH,CAAS,MAAML,WAAA,CAAGM,IAAH,CAAQP,QAAR,EAAkB,IAAlB,CAAf,CAAN;IACD;;IACD,OAAO,IAAP;EACD,CAVD,CAUE,OAAOQ,GAAP,EAAY;IACZ,OAAO,KAAP;EACD;AACF,CAdD;;AAgBAjB,OAAO,CAACkB,OAAR,GAAkB,gBAAgBhB,GAAhB,EAAqBiB,OAArB,EAA8B;EAC9C,IAAI,EAAC,MAAM,KAAKX,WAAL,CAAiBW,OAAjB,CAAP,CAAJ,EAAsC;IACpC,MAAM,IAAIZ,KAAJ,CAAW,uBAAsBY,OAAQ,sBAA/B,GACb,wEAAuEC,aAAA,CAAKC,OAAL,CAAaF,OAAb,CAAsB,IADhF,GAEb,0DAFG,CAAN;EAGD;;EACD,MAAMjB,GAAG,CAACoB,IAAJ,CAASH,OAAT,CAAN;AACD,CAPD;;eASenB,O"}