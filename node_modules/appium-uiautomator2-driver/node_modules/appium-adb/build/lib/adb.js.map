{"version":3,"file":"adb.js","names":["DEFAULT_ADB_PORT","DEFAULT_OPTS","sdkRoot","getSdkRootFromEnv","udid","appDeviceReadyTimeout","useKeystore","keystorePath","keystorePassword","keyAlias","keyPassword","executable","path","defaultArgs","tmpDir","os","tmpdir","curDeviceId","emulatorPort","logcat","binaries","instrumentProc","suppressKillServer","jars","adbPort","adbHost","adbExecTimeout","DEFAULT_ADB_EXEC_TIMEOUT","remoteAppsCacheLimit","buildToolsVersion","allowOfflineDevices","allowDelayAdb","ADB","constructor","opts","Object","assign","_","defaultsDeep","cloneDeep","remoteAdbHost","push","remoteAdbPort","clone","originalOptions","pick","keys","cloneOptions","includes","splice","indexOf","createADB","adb","requireSdkRoot","getAdbWithCorrectAdbPath","adbExec","e","log","warn","stderr","message","fnName","fn","toPairs","methods","prototype"],"sources":["../../lib/adb.js"],"sourcesContent":["import _ from 'lodash';\nimport os from 'os';\nimport methods, { getAndroidBinaryPath } from './tools/index.js';\nimport {\n  DEFAULT_ADB_EXEC_TIMEOUT, requireSdkRoot, getSdkRootFromEnv\n} from './helpers';\nimport log from './logger.js';\n\nconst DEFAULT_ADB_PORT = 5037;\nconst DEFAULT_OPTS = {\n  sdkRoot: getSdkRootFromEnv() || null,\n  udid: null,\n  appDeviceReadyTimeout: null,\n  useKeystore: null,\n  keystorePath: null,\n  keystorePassword: null,\n  keyAlias: null,\n  keyPassword: null,\n  executable: {path: 'adb', defaultArgs: []},\n  tmpDir: os.tmpdir(),\n  curDeviceId: null,\n  emulatorPort: null,\n  logcat: null,\n  binaries: {},\n  instrumentProc: null,\n  suppressKillServer: null,\n  jars: {},\n  adbPort: DEFAULT_ADB_PORT,\n  adbHost: null,\n  adbExecTimeout: DEFAULT_ADB_EXEC_TIMEOUT,\n  remoteAppsCacheLimit: 10,\n  buildToolsVersion: null,\n  allowOfflineDevices: false,\n  allowDelayAdb: true,\n};\n\nclass ADB {\n  constructor (opts = {}) {\n    Object.assign(this, opts);\n    _.defaultsDeep(this, _.cloneDeep(DEFAULT_OPTS));\n\n    if (opts.remoteAdbHost) {\n      this.executable.defaultArgs.push('-H', opts.remoteAdbHost);\n      this.adbHost = opts.remoteAdbHost;\n    }\n    // TODO figure out why we have this option as it does not appear to be\n    // used anywhere. Probably deprecate in favor of simple opts.adbPort\n    if (opts.remoteAdbPort) {\n      this.adbPort = opts.remoteAdbPort;\n    }\n    this.executable.defaultArgs.push('-P', this.adbPort);\n  }\n\n  /**\n   * Create a new instance of `ADB` that inherits configuration from this `ADB` instance.\n   * This avoids the need to call `ADB.createADB()` multiple times.\n   * @param {object} opts - Additional options mapping to pass to the `ADB` constructor.\n   * @returns {ADB} The resulting class instance.\n   */\n  clone (opts = {}) {\n    const originalOptions = _.cloneDeep(_.pick(this, Object.keys(DEFAULT_OPTS)));\n    const cloneOptions = _.defaultsDeep(opts, originalOptions);\n\n    // Reset default arguments created in the constructor.\n    // Without this code, -H and -P can be injected into defaultArgs multiple times.\n    const defaultArgs = cloneOptions.executable.defaultArgs;\n    if (cloneOptions.remoteAdbHost && defaultArgs.includes('-H')) {\n      defaultArgs.splice(defaultArgs.indexOf('-H'), 2);\n    }\n    if (defaultArgs.includes('-P')) {\n      defaultArgs.splice(defaultArgs.indexOf('-P'), 2);\n    }\n\n    return new ADB(cloneOptions);\n  }\n}\n\nADB.createADB = async function createADB (opts) {\n  const adb = new ADB(opts);\n  adb.sdkRoot = await requireSdkRoot(adb.sdkRoot);\n  await adb.getAdbWithCorrectAdbPath();\n  try {\n    await adb.adbExec(['start-server']);\n  } catch (e) {\n    log.warn(e.stderr || e.message);\n  }\n  return adb;\n};\n\n// add all the methods to the ADB prototype\nfor (const [fnName, fn] of _.toPairs(methods)) {\n  ADB.prototype[fnName] = fn;\n}\n\nexport default ADB;\nexport { ADB, DEFAULT_ADB_PORT, getAndroidBinaryPath, getSdkRootFromEnv };\n"],"mappings":"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"}