{"version":3,"file":"shell.js","names":["ADB_SHELL_FEATURE","commands","mobileShell","opts","ensureFeatureEnabled","command","args","timeout","includeStderr","_","isString","errors","InvalidArgumentError","adbArgs","adb","executable","defaultArgs","isArray","log","debug","path","util","quote","stdout","stderr","exec","err","errorAndThrow","message"],"sources":["../../../lib/commands/shell.js"],"sourcesContent":["import _ from 'lodash';\nimport { exec } from 'teen_process';\nimport { util } from 'appium/support';\nimport { errors } from 'appium/driver';\n\nconst ADB_SHELL_FEATURE = 'adb_shell';\n\nlet commands = {};\n\ncommands.mobileShell = async function mobileShell (opts = {}) {\n  this.ensureFeatureEnabled(ADB_SHELL_FEATURE);\n\n  const {\n    command,\n    args = [],\n    timeout = 20000,\n    includeStderr,\n  } = opts;\n\n  if (!_.isString(command)) {\n    throw new errors.InvalidArgumentError(`The 'command' argument is mandatory`);\n  }\n\n  const adbArgs = [\n    ...this.adb.executable.defaultArgs,\n    'shell',\n    command,\n    ...(_.isArray(args) ? args : [args])\n  ];\n  this.log.debug(`Running '${this.adb.executable.path} ${util.quote(adbArgs)}'`);\n  try {\n    const {stdout, stderr} = await exec(this.adb.executable.path, adbArgs, {timeout});\n    if (includeStderr) {\n      return {\n        stdout,\n        stderr\n      };\n    }\n    return stdout;\n  } catch (err) {\n    this.log.errorAndThrow(`Cannot execute the '${command}' shell command. ` +\n      `Original error: ${err.message}. ` +\n      `StdOut: ${err.stdout}. StdErr: ${err.stderr}`);\n  }\n};\n\nexport { commands };\nexport default commands;\n"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA,MAAMA,iBAAiB,GAAG,WAA1B;AAEA,IAAIC,QAAQ,GAAG,EAAf;;;AAEAA,QAAQ,CAACC,WAAT,GAAuB,eAAeA,WAAf,CAA4BC,IAAI,GAAG,EAAnC,EAAuC;EAC5D,KAAKC,oBAAL,CAA0BJ,iBAA1B;EAEA,MAAM;IACJK,OADI;IAEJC,IAAI,GAAG,EAFH;IAGJC,OAAO,GAAG,KAHN;IAIJC;EAJI,IAKFL,IALJ;;EAOA,IAAI,CAACM,eAAA,CAAEC,QAAF,CAAWL,OAAX,CAAL,EAA0B;IACxB,MAAM,IAAIM,cAAA,CAAOC,oBAAX,CAAiC,qCAAjC,CAAN;EACD;;EAED,MAAMC,OAAO,GAAG,CACd,GAAG,KAAKC,GAAL,CAASC,UAAT,CAAoBC,WADT,EAEd,OAFc,EAGdX,OAHc,EAId,IAAII,eAAA,CAAEQ,OAAF,CAAUX,IAAV,IAAkBA,IAAlB,GAAyB,CAACA,IAAD,CAA7B,CAJc,CAAhB;EAMA,KAAKY,GAAL,CAASC,KAAT,CAAgB,YAAW,KAAKL,GAAL,CAASC,UAAT,CAAoBK,IAAK,IAAGC,aAAA,CAAKC,KAAL,CAAWT,OAAX,CAAoB,GAA3E;;EACA,IAAI;IACF,MAAM;MAACU,MAAD;MAASC;IAAT,IAAmB,MAAM,IAAAC,kBAAA,EAAK,KAAKX,GAAL,CAASC,UAAT,CAAoBK,IAAzB,EAA+BP,OAA/B,EAAwC;MAACN;IAAD,CAAxC,CAA/B;;IACA,IAAIC,aAAJ,EAAmB;MACjB,OAAO;QACLe,MADK;QAELC;MAFK,CAAP;IAID;;IACD,OAAOD,MAAP;EACD,CATD,CASE,OAAOG,GAAP,EAAY;IACZ,KAAKR,GAAL,CAASS,aAAT,CAAwB,uBAAsBtB,OAAQ,mBAA/B,GACpB,mBAAkBqB,GAAG,CAACE,OAAQ,IADV,GAEpB,WAAUF,GAAG,CAACH,MAAO,aAAYG,GAAG,CAACF,MAAO,EAF/C;EAGD;AACF,CAnCD;;eAsCevB,Q"}