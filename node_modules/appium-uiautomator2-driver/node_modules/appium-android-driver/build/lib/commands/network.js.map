{"version":3,"file":"network.js","names":["commands","helpers","extensions","AIRPLANE_MODE_MASK","WIFI_MASK","DATA_MASK","GEO_EPSILON","Number","MIN_VALUE","getNetworkConnection","log","info","airplaneModeOn","adb","isAirplaneModeOn","connection","wifiOn","isWifiOn","dataOn","isDataOn","setNetworkConnection","type","shouldEnableAirplaneMode","shouldEnableWifi","shouldEnableDataConnection","currentState","isAirplaneModeEnabled","isWiFiEnabled","isDataEnabled","wrapBootstrapDisconnect","setAirplaneMode","broadcastAirplaneMode","setWifiState","setDataState","isEmulator","wifi","toggleData","data","setWifiAndData","toggleWiFi","toggleFlightMode","flightMode","setGeoLocation","location","getGeoLocation","e","warn","message","latitude","longitude","altitude","mobileRefreshGpsCache","opts","timeoutMs","refreshGeoLocationCache","parseFloat","KeyCode","UP","DOWN","RIGHT","CENTER","toggleLocationServices","api","getApiLevel","providers","getLocationProviders","isGpsEnabled","indexOf","toggleGPSLocationProvider","seq","push","keyevent","toggleSetting","errors","NotYetImplementedError","setting","preKeySeq","_","isNull","openSettingsActivity","key","doKey","appPackage","appActivity","getFocusedPackageAndActivity","waitForNotActivity","ign","back","B","delay","wrapped","bootstrap","ignoreUnexpectedShutdown","restart","start","disableAndroidWatchers","acceptSslCerts","Object","assign"],"sources":["../../../lib/commands/network.js"],"sourcesContent":["import _ from 'lodash';\nimport { errors } from 'appium/driver';\nimport B from 'bluebird';\n\nlet commands = {}, helpers = {}, extensions = {};\n\nconst AIRPLANE_MODE_MASK = 0b001;\nconst WIFI_MASK = 0b010;\nconst DATA_MASK = 0b100;\n// The value close to zero, but not zero, is needed\n// to trick JSON generation and send a float value instead of an integer,\n// This allows strictly-typed clients, like Java, to properly\n// parse it. Otherwise float 0.0 is always represented as integer 0 in JS.\n// The value must not be greater than DBL_EPSILON (https://opensource.apple.com/source/Libc/Libc-498/include/float.h)\nconst GEO_EPSILON = Number.MIN_VALUE;\n\ncommands.getNetworkConnection = async function getNetworkConnection () {\n  this.log.info('Getting network connection');\n  let airplaneModeOn = await this.adb.isAirplaneModeOn();\n  let connection = airplaneModeOn ? AIRPLANE_MODE_MASK : 0;\n\n  // no need to check anything else if we are in airplane mode\n  if (!airplaneModeOn) {\n    let wifiOn = await this.isWifiOn();\n    connection |= (wifiOn ? WIFI_MASK : 0);\n    let dataOn = await this.adb.isDataOn();\n    connection |= (dataOn ? DATA_MASK : 0);\n  }\n\n  return connection;\n};\n\n/**\n * decoupling to override the behaviour in other drivers like UiAutomator2.\n */\ncommands.isWifiOn = async function isWifiOn () {\n  return await this.adb.isWifiOn();\n};\n\ncommands.setNetworkConnection = async function setNetworkConnection (type) {\n  this.log.info('Setting network connection');\n  // decode the input\n  const shouldEnableAirplaneMode = (type & AIRPLANE_MODE_MASK) !== 0;\n  const shouldEnableWifi = (type & WIFI_MASK) !== 0;\n  const shouldEnableDataConnection = (type & DATA_MASK) !== 0;\n\n  const currentState = await this.getNetworkConnection();\n  const isAirplaneModeEnabled = (currentState & AIRPLANE_MODE_MASK) !== 0;\n  const isWiFiEnabled = (currentState & WIFI_MASK) !== 0;\n  const isDataEnabled = (currentState & DATA_MASK) !== 0;\n\n  if (shouldEnableAirplaneMode !== isAirplaneModeEnabled) {\n    await this.wrapBootstrapDisconnect(async () => {\n      await this.adb.setAirplaneMode(shouldEnableAirplaneMode);\n    });\n    await this.wrapBootstrapDisconnect(async () => {\n      await this.adb.broadcastAirplaneMode(shouldEnableAirplaneMode);\n    });\n  } else {\n    this.log.info(`Not changing airplane mode, since it is already ` +\n             `${shouldEnableAirplaneMode ? 'enabled' : 'disabled'}`);\n  }\n\n  if (shouldEnableWifi === isWiFiEnabled && shouldEnableDataConnection === isDataEnabled) {\n    this.log.info('Not changing data connection/Wi-Fi states, since they are already set to expected values');\n    if (await this.adb.isAirplaneModeOn()) {\n      return AIRPLANE_MODE_MASK | currentState;\n    }\n    return ~AIRPLANE_MODE_MASK & currentState;\n  }\n\n  await this.wrapBootstrapDisconnect(async () => {\n    if (shouldEnableWifi !== isWiFiEnabled) {\n      await this.setWifiState(shouldEnableWifi);\n    } else {\n      this.log.info(`Not changing Wi-Fi state, since it is already ` +\n        `${shouldEnableWifi ? 'enabled' : 'disabled'}`);\n    }\n\n    if (shouldEnableAirplaneMode) {\n      this.log.info('Not changing data connection state, because airplane mode is enabled');\n    } else if (shouldEnableDataConnection === isDataEnabled) {\n      this.log.info(`Not changing data connection state, since it is already ` +\n        `${shouldEnableDataConnection ? 'enabled' : 'disabled'}`);\n    } else {\n      await this.adb.setDataState(shouldEnableDataConnection, this.isEmulator());\n    }\n  });\n\n  return await this.getNetworkConnection();\n};\n\n/**\n * decoupling to override behaviour in other drivers like UiAutomator2.\n */\ncommands.setWifiState = async function setWifiState (wifi) {\n  await this.adb.setWifiState(wifi, this.isEmulator());\n};\n\ncommands.toggleData = async function toggleData () {\n  let data = !(await this.adb.isDataOn());\n  this.log.info(`Turning network data ${data ? 'on' : 'off'}`);\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.setWifiAndData({data}, this.isEmulator());\n  });\n};\n\ncommands.toggleWiFi = async function toggleWiFi () {\n  let wifi = !(await this.adb.isWifiOn());\n  this.log.info(`Turning WiFi ${wifi ? 'on' : 'off'}`);\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.setWifiAndData({wifi}, this.isEmulator());\n  });\n};\n\ncommands.toggleFlightMode = async function toggleFlightMode () {\n  /*\n   * TODO: Implement isRealDevice(). This method fails on\n   * real devices, it should throw a NotYetImplementedError\n   */\n  let flightMode = !(await this.adb.isAirplaneModeOn());\n  this.log.info(`Turning flight mode ${flightMode ? 'on' : 'off'}`);\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.setAirplaneMode(flightMode);\n  });\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.broadcastAirplaneMode(flightMode);\n  });\n};\n\ncommands.setGeoLocation = async function setGeoLocation (location) {\n  await this.adb.setGeoLocation(location, this.isEmulator());\n  try {\n    return await this.getGeoLocation();\n  } catch (e) {\n    this.log.warn(`Could not get the current geolocation info: ${e.message}`);\n    this.log.warn(`Returning the default zero'ed values`);\n    return {\n      latitude: GEO_EPSILON,\n      longitude: GEO_EPSILON,\n      altitude: GEO_EPSILON,\n    };\n  }\n};\n\n/**\n * @typedef {Object} GpsCacheRefreshOptions\n * @property {number} timeoutMs [20000] The maximum number of milliseconds\n * to block until GPS cache is refreshed. Providing zero or a negative\n * value to it skips waiting completely.\n */\n\n/**\n * Sends an async request to refresh the GPS cache.\n * This feature only works if the device under test has\n * Google Play Services installed. In case the vanilla\n * LocationManager is used the device API level must be at\n * version 30 (Android R) or higher.\n *\n * @param {GpsCacheRefreshOptions} opts\n */\ncommands.mobileRefreshGpsCache = async function mobileRefreshGpsCache (opts = {}) {\n  const { timeoutMs } = opts;\n  await this.adb.refreshGeoLocationCache(timeoutMs);\n};\n\ncommands.getGeoLocation = async function getGeoLocation () {\n  const {latitude, longitude, altitude} = await this.adb.getGeoLocation();\n  return {\n    latitude: parseFloat(latitude) || GEO_EPSILON,\n    longitude: parseFloat(longitude) || GEO_EPSILON,\n    altitude: parseFloat(altitude) || GEO_EPSILON,\n  };\n};\n// https://developer.android.com/reference/android/view/KeyEvent.html#KEYCODE_DPAD_CENTER\n// in the android docs, this is how the keycodes are defined\nconst KeyCode = {\n  UP: 19,\n  DOWN: 20,\n  RIGHT: 22,\n  CENTER: 23\n};\ncommands.toggleLocationServices = async function toggleLocationServices () {\n  this.log.info('Toggling location services');\n  let api = await this.adb.getApiLevel();\n  if (this.isEmulator()) {\n    let providers = await this.adb.getLocationProviders();\n    let isGpsEnabled = providers.indexOf('gps') !== -1;\n    await this.adb.toggleGPSLocationProvider(!isGpsEnabled);\n    return;\n  }\n\n  if (api > 15) {\n    let seq = [KeyCode.UP, KeyCode.UP];\n    if (api === 16) {\n      // This version of Android has a \"parent\" button in its action bar\n      seq.push(KeyCode.DOWN);\n    } else if (api < 28) {\n      // Newer versions of Android have the toggle in the Action bar\n      seq = [KeyCode.RIGHT, KeyCode.RIGHT, KeyCode.UP];\n      /*\n       * Once the Location services switch is OFF, it won't receive focus\n       * when going back to the Location Services settings screen unless we\n       * send a dummy keyevent (UP) *before* opening the settings screen\n       */\n      await this.adb.keyevent(KeyCode.UP);\n    } else if (api >= 28) {\n      // Even newer versions of android have the toggle in a bar below the action bar\n      // this means a single right click will cause it to be selected.\n      seq = [KeyCode.RIGHT];\n      await this.adb.keyevent(KeyCode.UP);\n    }\n    await this.toggleSetting('LOCATION_SOURCE_SETTINGS', seq);\n  } else {\n    // There's no global location services toggle on older Android versions\n    throw new errors.NotYetImplementedError();\n  }\n};\n\nhelpers.toggleSetting = async function toggleSetting (setting, preKeySeq) {\n  /*\n   * preKeySeq is the keyevent sequence to send over ADB in order\n   * to position the cursor on the right option.\n   * By default it's [up, up, down] because we usually target the 1st item in\n   * the screen, and sometimes when opening settings activities the cursor is\n   * already positionned on the 1st item, but we can't know for sure\n   */\n  if (_.isNull(preKeySeq)) {\n    preKeySeq = [KeyCode.UP, KeyCode.UP, KeyCode.DOWN];\n  }\n\n  await this.openSettingsActivity(setting);\n\n  for (let key of preKeySeq) {\n    await this.doKey(key);\n  }\n\n  let {appPackage, appActivity} = await this.adb.getFocusedPackageAndActivity();\n\n  /*\n   * Click and handle potential ADB disconnect that occurs on official\n   * emulator when the network connection is disabled\n   */\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.doKey(KeyCode.CENTER);\n  });\n\n  /*\n   * In one particular case (enable Location Services), a pop-up is\n   * displayed on some platforms so the user accepts or refuses that Google\n   * collects location data. So we wait for that pop-up to open, if it\n   * doesn't then proceed\n   */\n  try {\n    await this.adb.waitForNotActivity(appPackage, appActivity, 5000);\n    await this.doKey(KeyCode.RIGHT);\n    await this.doKey(KeyCode.CENTER);\n    await this.adb.waitForNotActivity(appPackage, appActivity, 5000);\n  } catch (ign) {}\n\n  await this.adb.back();\n};\n\nhelpers.doKey = async function doKey (key) {\n  // TODO: Confirm we need this delay. Seems to work without it.\n  await B.delay(2000);\n  await this.adb.keyevent(key);\n};\n\nhelpers.wrapBootstrapDisconnect = async function wrapBootstrapDisconnect (wrapped) {\n  if (!this.bootstrap) {\n    return await wrapped();\n  }\n\n  this.bootstrap.ignoreUnexpectedShutdown = true;\n  try {\n    await wrapped();\n    await this.adb.restart();\n    await this.bootstrap.start(this.opts.appPackage, this.opts.disableAndroidWatchers, this.opts.acceptSslCerts);\n  } finally {\n    this.bootstrap.ignoreUnexpectedShutdown = false;\n  }\n};\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers };\nexport default extensions;\n"],"mappings":"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"}