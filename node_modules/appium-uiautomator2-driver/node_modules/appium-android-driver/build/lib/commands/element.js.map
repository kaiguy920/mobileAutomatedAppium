{"version":3,"file":"element.js","names":["commands","helpers","extensions","getAttribute","attribute","elementId","p","bootstrap","sendAction","getName","elementDisplayed","elementEnabled","elementSelected","setElementValue","keys","replace","text","Array","join","params","unicodeKeyboard","opts","doSetElementValue","setValue","replaceValue","setValueImmediate","click","adb","inputText","getText","clear","length","log","debug","retryInterval","remainingLength","lengthToSend","clearTextField","getLocation","getLocationInView","getSize","getElementRect","touchLongClick","x","y","duration","androidHelpers","removeNullProperties","touchDown","touchUp","touchMove","complexTap","tapCount","touchCount","tap","count","util","hasValue","Error","i","Object","assign"],"sources":["../../../lib/commands/element.js"],"sourcesContent":["import androidHelpers from '../android-helpers';\nimport { retryInterval } from 'asyncbox';\nimport { util } from 'appium/support';\n\n\nlet commands = {}, helpers = {}, extensions = {};\n\ncommands.getAttribute = async function getAttribute (attribute, elementId) {\n  let p = {attribute, elementId};\n  return await this.bootstrap.sendAction('element:getAttribute', p);\n};\n\ncommands.getName = async function getName (elementId) {\n  return await this.getAttribute('className', elementId);\n};\n\ncommands.elementDisplayed = async function elementDisplayed (elementId) {\n  return await this.getAttribute('displayed', elementId) === 'true';\n};\n\ncommands.elementEnabled = async function elementEnabled (elementId) {\n  return await this.getAttribute('enabled', elementId) === 'true';\n};\n\ncommands.elementSelected = async function elementSelected (elementId) {\n  return await this.getAttribute('selected', elementId) === 'true';\n};\n\nhelpers.setElementValue = async function setElementValue (keys, elementId, replace = false) {\n  let text = keys;\n  if (keys instanceof Array) {\n    text = keys.join('');\n  }\n\n  let params = {\n    elementId,\n    text,\n    replace,\n    unicodeKeyboard: this.opts.unicodeKeyboard\n  };\n\n  return await this.doSetElementValue(params);\n};\n\n/**\n * Reason for isolating doSetElementValue from setElementValue is for reusing setElementValue\n * across android-drivers (like appium-uiautomator2-driver) and to avoid code duplication.\n * Other android-drivers (like appium-uiautomator2-driver) need to override doSetElementValue\n * to facilitate setElementValue.\n */\nhelpers.doSetElementValue = async function doSetElementValue (params) {\n  return await this.bootstrap.sendAction('element:setText', params);\n};\n\ncommands.setValue = async function setValue (keys, elementId) {\n  return await this.setElementValue(keys, elementId, false);\n};\n\ncommands.replaceValue = async function replaceValue (keys, elementId) {\n  return await this.setElementValue(keys, elementId, true);\n};\n\ncommands.setValueImmediate = async function setValueImmediate (keys, elementId) {\n  let text = keys;\n  if (keys instanceof Array) {\n    text = keys.join('');\n  }\n\n  // first, make sure we are focused on the element\n  await this.click(elementId);\n\n  // then send through adb\n  await this.adb.inputText(text);\n};\n\ncommands.getText = async function getText (elementId) {\n  return await this.bootstrap.sendAction('element:getText', {elementId});\n};\n\ncommands.clear = async function clear (elementId) {\n  let text = (await this.getText(elementId)) || '';\n  let length = text.length;\n  if (length === 0) {\n    // if length is zero there are two possibilities:\n    //   1. there is nothing in the text field\n    //   2. it is a password field\n    // since there is little overhead to the adb call, delete 100 elements\n    // if we get zero, just in case it is #2\n    length = 100;\n  }\n  await this.click(elementId);\n  this.log.debug(`Sending up to ${length} clear characters to device`);\n  return await retryInterval(5, 500, async () => {\n    let remainingLength = length;\n    while (remainingLength > 0) {\n      let lengthToSend = remainingLength < 50 ? remainingLength : 50;\n      this.log.debug(`Sending ${lengthToSend} clear characters to device`);\n      await this.adb.clearTextField(lengthToSend);\n      remainingLength -= lengthToSend;\n    }\n  });\n};\n\ncommands.click = async function click (elementId) {\n  return await this.bootstrap.sendAction('element:click', {elementId});\n};\n\ncommands.getLocation = async function getLocation (elementId) {\n  return await this.bootstrap.sendAction('element:getLocation', {elementId});\n};\n\ncommands.getLocationInView = async function getLocationInView (elementId) {\n  return await this.getLocation(elementId);\n};\n\ncommands.getSize = async function getSize (elementId) {\n  return await this.bootstrap.sendAction('element:getSize', {elementId});\n};\n\ncommands.getElementRect = async function getElementRect (elementId) {\n  return await this.bootstrap.sendAction('element:getRect', {elementId});\n};\n\ncommands.touchLongClick = async function touchLongClick (elementId, x, y, duration) {\n  let params = {elementId, x, y, duration};\n  androidHelpers.removeNullProperties(params);\n  return await this.bootstrap.sendAction('element:touchLongClick', params);\n};\n\ncommands.touchDown = async function touchDown (elementId, x, y) {\n  let params = {elementId, x, y};\n  androidHelpers.removeNullProperties(params);\n  return await this.bootstrap.sendAction('element:touchDown', params);\n};\n\ncommands.touchUp = async function touchUp (elementId, x, y) {\n  let params = {elementId, x, y};\n  androidHelpers.removeNullProperties(params);\n  return await this.bootstrap.sendAction('element:touchUp', params);\n};\n\ncommands.touchMove = async function touchMove (elementId, x, y) {\n  let params = {elementId, x, y};\n  androidHelpers.removeNullProperties(params);\n  return await this.bootstrap.sendAction('element:touchMove', params);\n};\n\ncommands.complexTap = async function complexTap (tapCount, touchCount, duration, x, y) {\n  return await this.bootstrap.sendAction('click', {x, y});\n};\n\ncommands.tap = async function (elementId = null, x = null, y = null, count = 1) {\n  if (!util.hasValue(elementId) && !util.hasValue(x) && !util.hasValue(y)) {\n    throw new Error(`Either element to tap or both absolute coordinates should be defined`);\n  }\n  for (let i = 0; i < count; i++) {\n    if (util.hasValue(elementId)) {\n      // FIXME: bootstrap ignores relative coordinates\n      await this.bootstrap.sendAction('element:click', {elementId, x, y});\n    } else {\n      await this.bootstrap.sendAction('click', {x, y});\n    }\n  }\n};\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers };\nexport default extensions;\n"],"mappings":"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"}