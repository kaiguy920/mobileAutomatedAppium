{"version":3,"file":"driver.js","names":["APP_EXTENSION","DEVICE_PORT","NO_PROXY","RegExp","AndroidDriver","BaseDriver","constructor","opts","shouldValidateCaps","locatorStrategies","desiredCapConstraints","desiredConstraints","sessionChromedrivers","jwpProxyActive","jwpProxyAvoid","_","clone","settings","DeviceSettings","ignoreUnimportantViews","onSettingsUpdate","bind","chromedriver","apkStrings","unlocker","helpers","cmd","fn","toPairs","commands","prototype","curContext","defaultContextName","createSession","args","sessionId","caps","serverDetails","platform","webStorageEnabled","takesScreenshot","javascriptEnabled","databaseEnabled","networkConnectionEnabled","locationContextEnabled","warnings","desired","Object","assign","defaultOpts","action","category","flags","disableAndroidWatchers","tmpDir","tempDir","staticDir","fullReset","autoLaunch","adbPort","DEFAULT_ADB_PORT","bootstrapPort","androidInstallTimeout","defaults","useUnlockHelperApp","isUndefined","unlockType","noReset","fastReset","skipUninstall","isChromeSession","adjustBrowserSessionCaps","nativeWebScreenshot","push","reboot","setAvdFromCapabilities","udid","emPort","getDeviceInfoFromCaps","adb","createADB","suppressKillServer","remoteAdbHost","clearDeviceLogsOnStart","adbExecTimeout","allowOfflineDevices","getApiLevel","log","warn","isPackageOrBundle","app","appPackage","configureApp","checkAppPresent","appOnDevice","info","checkPackagePresent","util","hasValue","networkSpeed","isEmulator","ensureNetworkSpeed","gpsEnabled","toggleGPSLocationProvider","startAndroidSession","e","deleteSession","ign","avd","deviceName","errorAndThrow","platformVersion","avdDevice","replace","isChromeBrowser","browserName","key","value","setCompressedLayoutHierarchy","defaultIME","initDevice","curDeviceId","deviceUDID","getPlatformVersion","deviceScreenSize","getScreenSize","deviceModel","getModel","deviceManufacturer","getManufacturer","disableWindowAnimation","isAnimationOn","setHiddenApiPolicy","ignoreHiddenApiPolicyError","setAnimationState","_wasWindowAnimationDisabled","initAUT","bootstrap","websocket","start","acceptSslCerts","onUnexpectedShutdown","err","ignoreUnexpectedShutdown","startUnexpectedShutdown","skipUnlock","unlock","update","startChromeSession","startAUT","orientation","debug","setOrientation","initAutoWebview","autoWebview","viewName","defaultWebviewName","timeout","autoWebviewTimeout","retryInterval","setContext","launchInfo","getLaunchInfo","uninstallOtherPackages","validateDesiredCaps","parseArray","SETTINGS_HELPER_PKG_ID","otherApps","message","B","all","map","installOtherApks","resetApp","uninstallApk","installApk","apkStringsForLanguage","pushStrings","language","sharedPreferences","setSharedPreferences","fs","exists","shell","compress","sendAction","compressLayout","isEmpty","_screenRecordingProperties","stopRecordingScreen","removeAllSessionWebSocketHandlers","server","mobileStopScreenStreaming","stopChromedriverProxies","unicodeKeyboard","resetKeyboard","setIME","dontStopAppOnReset","forceStop","goToHome","shutdown","stopLogcat","setDefaultHiddenApiPolicy","avdName","killEmulator","sharedPrefs","name","JSON","stringify","remotePath","remoteFile","localPath","builder","getPrefsBuilder","build","prefs","toFile","unlink","SharedPrefsBuilder","proxyActive","getProxyAvoidList","canProxy","isFunction","proxyReqRes"],"sources":["../../lib/driver.js"],"sourcesContent":["import { BaseDriver, DeviceSettings } from 'appium/driver';\nimport desiredConstraints from './desired-caps';\nimport commands from './commands/index';\nimport {\n  helpers, ensureNetworkSpeed,\n  SETTINGS_HELPER_PKG_ID,\n} from './android-helpers';\nimport _ from 'lodash';\nimport { DEFAULT_ADB_PORT } from 'appium-adb';\nimport { fs, tempDir, util } from 'appium/support';\nimport { retryInterval } from 'asyncbox';\nimport { SharedPrefsBuilder } from 'shared-preferences-builder';\nimport B from 'bluebird';\n\nconst APP_EXTENSION = '.apk';\nconst DEVICE_PORT = 4724;\n\n// This is a set of methods and paths that we never want to proxy to\n// Chromedriver\nconst NO_PROXY = [\n  ['POST', new RegExp('^/session/[^/]+/context')],\n  ['GET', new RegExp('^/session/[^/]+/context')],\n  ['POST', new RegExp('^/session/[^/]+/appium')],\n  ['GET', new RegExp('^/session/[^/]+/appium')],\n  ['POST', new RegExp('^/session/[^/]+/touch/perform')],\n  ['POST', new RegExp('^/session/[^/]+/touch/multi/perform')],\n  ['POST', new RegExp('^/session/[^/]+/orientation')],\n  ['GET', new RegExp('^/session/[^/]+/orientation')],\n  ['POST', new RegExp('^/session/[^/]+/execute')],\n  ['POST', new RegExp('^/session/[^/]+/execute/sync')],\n  ['GET', new RegExp('^/session/[^/]+/network_connection')],\n  ['POST', new RegExp('^/session/[^/]+/network_connection')],\n];\n\nclass AndroidDriver extends BaseDriver {\n  constructor (opts = {}, shouldValidateCaps = true) {\n    super(opts, shouldValidateCaps);\n\n    this.locatorStrategies = [\n      'xpath',\n      'id',\n      'class name',\n      'accessibility id',\n      '-android uiautomator'\n    ];\n    this.desiredCapConstraints = desiredConstraints;\n    this.sessionChromedrivers = {};\n    this.jwpProxyActive = false;\n    this.jwpProxyAvoid = _.clone(NO_PROXY);\n    this.settings = new DeviceSettings({ignoreUnimportantViews: false},\n                                       this.onSettingsUpdate.bind(this));\n    this.chromedriver = null;\n    this.apkStrings = {};\n    this.unlocker = helpers.unlocker;\n\n    for (let [cmd, fn] of _.toPairs(commands)) {\n      AndroidDriver.prototype[cmd] = fn;\n    }\n\n    // needs to be after the line which assigns commands to AndroidDriver.prototype, so that `this.defaultContextName` is defined.\n    this.curContext = this.defaultContextName();\n  }\n\n  async createSession (...args) {\n    // the whole createSession flow is surrounded in a try-catch statement\n    // if creating a session fails at any point, we teardown everything we\n    // set up before throwing the error.\n    try {\n      let [sessionId, caps] = await super.createSession(...args);\n\n      let serverDetails = {\n        platform: 'LINUX',\n        webStorageEnabled: false,\n        takesScreenshot: true,\n        javascriptEnabled: true,\n        databaseEnabled: false,\n        networkConnectionEnabled: true,\n        locationContextEnabled: false,\n        warnings: {},\n        desired: this.caps\n      };\n\n      this.caps = Object.assign(serverDetails, this.caps);\n\n      // assigning defaults\n      let defaultOpts = {\n        action: 'android.intent.action.MAIN',\n        category: 'android.intent.category.LAUNCHER',\n        flags: '0x10200000',\n        disableAndroidWatchers: false,\n        tmpDir: await tempDir.staticDir(),\n        fullReset: false,\n        autoLaunch: true,\n        adbPort: DEFAULT_ADB_PORT,\n        bootstrapPort: DEVICE_PORT,\n        androidInstallTimeout: 90000,\n      };\n      _.defaults(this.opts, defaultOpts);\n      this.useUnlockHelperApp = _.isUndefined(this.caps.unlockType);\n\n      // not user visible via caps\n      if (this.opts.noReset === true) {\n        this.opts.fullReset = false;\n      }\n      if (this.opts.fullReset === true) {\n        this.opts.noReset = false;\n      }\n      this.opts.fastReset = !this.opts.fullReset && !this.opts.noReset;\n      this.opts.skipUninstall = this.opts.fastReset || this.opts.noReset;\n\n      if (this.isChromeSession) {\n        helpers.adjustBrowserSessionCaps(this.opts);\n      }\n\n      if (this.opts.nativeWebScreenshot) {\n        this.jwpProxyAvoid.push(['GET', new RegExp('^/session/[^/]+/screenshot')]);\n      }\n\n      if (this.opts.reboot) {\n        this.setAvdFromCapabilities(caps);\n      }\n\n      // get device udid for this session\n      let {udid, emPort} = await helpers.getDeviceInfoFromCaps(this.opts);\n      this.opts.udid = udid;\n      this.opts.emPort = emPort;\n\n      // set up an instance of ADB\n      this.adb = await helpers.createADB({\n        udid: this.opts.udid,\n        emPort: this.opts.emPort,\n        adbPort: this.opts.adbPort,\n        suppressKillServer: this.opts.suppressKillServer,\n        remoteAdbHost: this.opts.remoteAdbHost,\n        clearDeviceLogsOnStart: this.opts.clearDeviceLogsOnStart,\n        adbExecTimeout: this.opts.adbExecTimeout,\n        allowOfflineDevices: this.opts.allowOfflineDevices,\n      });\n\n      if (await this.adb.getApiLevel() >= 23) {\n        this.log.warn(\"Consider setting 'automationName' capability to \" +\n          \"'uiautomator2' on Android >= 6, since UIAutomator framework \" +\n          'is not maintained anymore by the OS vendor.');\n      }\n\n      if (this.helpers.isPackageOrBundle(this.opts.app)) {\n        // user provided package instead of app for 'app' capability, massage options\n        this.opts.appPackage = this.opts.app;\n        this.opts.app = null;\n      }\n\n      if (this.opts.app) {\n        // find and copy, or download and unzip an app url or path\n        this.opts.app = await this.helpers.configureApp(this.opts.app, APP_EXTENSION);\n        await this.checkAppPresent();\n      } else if (this.appOnDevice) {\n        // the app isn't an actual app file but rather something we want to\n        // assume is on the device and just launch via the appPackage\n        this.log.info(`App file was not listed, instead we're going to run ` +\n          `${this.opts.appPackage} directly on the device`);\n        await this.checkPackagePresent();\n      }\n\n      // Some cloud services using appium launch the avd themselves, so we ensure netspeed\n      // is set for emulators by calling adb.networkSpeed before running the app\n      if (util.hasValue(this.opts.networkSpeed)) {\n        if (!this.isEmulator()) {\n          this.log.warn('Sorry, networkSpeed capability is only available for emulators');\n        } else {\n          const networkSpeed = ensureNetworkSpeed(this.adb, this.opts.networkSpeed);\n          await this.adb.networkSpeed(networkSpeed);\n        }\n      }\n      // check if we have to enable/disable gps before running the application\n      if (util.hasValue(this.opts.gpsEnabled)) {\n        if (this.isEmulator()) {\n          this.log.info(`Trying to ${this.opts.gpsEnabled ? 'enable' : 'disable'} gps location provider`);\n          await this.adb.toggleGPSLocationProvider(this.opts.gpsEnabled);\n        } else {\n          this.log.warn('Sorry! gpsEnabled capability is only available for emulators');\n        }\n      }\n\n      await this.startAndroidSession(this.opts);\n      return [sessionId, this.caps];\n    } catch (e) {\n      // ignoring delete session exception if any and throw the real error\n      // that happened while creating the session.\n      try {\n        await this.deleteSession();\n      } catch (ign) {}\n      throw e;\n    }\n  }\n\n  isEmulator () {\n    return helpers.isEmulator(this.adb, this.opts);\n  }\n\n  setAvdFromCapabilities (caps) {\n    if (this.opts.avd) {\n      this.log.info('avd name defined, ignoring device name and platform version');\n    } else {\n      if (!caps.deviceName) {\n        this.log.errorAndThrow('avd or deviceName should be specified when reboot option is enables');\n      }\n      if (!caps.platformVersion) {\n        this.log.errorAndThrow('avd or platformVersion should be specified when reboot option is enabled');\n      }\n      let avdDevice = caps.deviceName.replace(/[^a-zA-Z0-9_.]/g, '-');\n      this.opts.avd = `${avdDevice}__${caps.platformVersion}`;\n    }\n  }\n\n  get appOnDevice () {\n    return this.helpers.isPackageOrBundle(this.opts.app) || (!this.opts.app &&\n           this.helpers.isPackageOrBundle(this.opts.appPackage));\n  }\n\n  get isChromeSession () {\n    return helpers.isChromeBrowser(this.opts.browserName);\n  }\n\n  async onSettingsUpdate (key, value) {\n    if (key === 'ignoreUnimportantViews') {\n      await this.setCompressedLayoutHierarchy(value);\n    }\n  }\n\n  async startAndroidSession () {\n    this.log.info(`Starting Android session`);\n    // set up the device to run on (real or emulator, etc)\n    this.defaultIME = await helpers.initDevice(this.adb, this.opts);\n\n    // set actual device name, udid, platform version, screen size, model and manufacturer details.\n    this.caps.deviceName = this.adb.curDeviceId;\n    this.caps.deviceUDID = this.opts.udid;\n    this.caps.platformVersion = await this.adb.getPlatformVersion();\n    this.caps.deviceScreenSize = await this.adb.getScreenSize();\n    this.caps.deviceModel = await this.adb.getModel();\n    this.caps.deviceManufacturer = await this.adb.getManufacturer();\n\n    if (this.opts.disableWindowAnimation) {\n      if (await this.adb.isAnimationOn()) {\n        if (await this.adb.getApiLevel() >= 28) { // API level 28 is Android P\n          // Don't forget to reset the relaxing in delete session\n          this.log.warn('Relaxing hidden api policy to manage animation scale');\n          await this.adb.setHiddenApiPolicy('1', !!this.opts.ignoreHiddenApiPolicyError);\n        }\n\n        this.log.info('Disabling window animation as it is requested by \"disableWindowAnimation\" capability');\n        await this.adb.setAnimationState(false);\n        this._wasWindowAnimationDisabled = true;\n      } else {\n        this.log.info('Window animation is already disabled');\n      }\n    }\n\n    // set up app under test\n    await this.initAUT();\n\n    // start UiAutomator\n    this.bootstrap = new helpers.bootstrap(this.adb, this.opts.bootstrapPort, this.opts.websocket);\n    await this.bootstrap.start(this.opts.appPackage, this.opts.disableAndroidWatchers, this.opts.acceptSslCerts);\n    // handling unexpected shutdown\n    (async () => {\n      try {\n        await this.bootstrap.onUnexpectedShutdown;\n      } catch (err) {\n        if (!this.bootstrap.ignoreUnexpectedShutdown) {\n          await this.startUnexpectedShutdown(err);\n        }\n      }\n    })();\n\n\n    if (!this.opts.skipUnlock) {\n      // Let's try to unlock the device\n      await helpers.unlock(this, this.adb, this.caps);\n    }\n\n    // Set CompressedLayoutHierarchy on the device based on current settings object\n    // this has to happen _after_ bootstrap is initialized\n    if (this.opts.ignoreUnimportantViews) {\n      await this.settings.update({ignoreUnimportantViews: this.opts.ignoreUnimportantViews});\n    }\n\n    if (this.isChromeSession) {\n      // start a chromedriver session and proxy to it\n      await this.startChromeSession();\n    } else {\n      if (this.opts.autoLaunch) {\n        // start app\n        await this.startAUT();\n      }\n    }\n\n    if (util.hasValue(this.opts.orientation)) {\n      this.log.debug(`Setting initial orientation to '${this.opts.orientation}'`);\n      await this.setOrientation(this.opts.orientation);\n    }\n\n    await this.initAutoWebview();\n  }\n\n  async initAutoWebview () {\n    if (this.opts.autoWebview) {\n      let viewName = this.defaultWebviewName();\n      let timeout = (this.opts.autoWebviewTimeout) || 2000;\n\n      this.log.info(`Setting auto webview to context '${viewName}' with timeout ${timeout}ms`);\n\n      // try every 500ms until timeout is over\n      await retryInterval(timeout / 500, 500, async () => {\n        await this.setContext(viewName);\n      });\n    }\n  }\n\n  async initAUT () {\n    // populate appPackage, appActivity, appWaitPackage, appWaitActivity,\n    // and the device being used\n    // in the opts and caps (so it gets back to the user on session creation)\n    let launchInfo = await helpers.getLaunchInfo(this.adb, this.opts);\n    Object.assign(this.opts, launchInfo);\n    Object.assign(this.caps, launchInfo);\n\n    // Uninstall any uninstallOtherPackages which were specified in caps\n    if (this.opts.uninstallOtherPackages) {\n      helpers.validateDesiredCaps(this.opts);\n      // Only SETTINGS_HELPER_PKG_ID package is used by UIA1\n      await helpers.uninstallOtherPackages(\n        this.adb,\n        helpers.parseArray(this.opts.uninstallOtherPackages),\n        [SETTINGS_HELPER_PKG_ID]\n      );\n    }\n\n    // Install any \"otherApps\" that were specified in caps\n    if (this.opts.otherApps) {\n      let otherApps;\n      try {\n        otherApps = helpers.parseArray(this.opts.otherApps);\n      } catch (e) {\n        this.log.errorAndThrow(`Could not parse \"otherApps\" capability: ${e.message}`);\n      }\n      otherApps = await B.all(otherApps.map((app) => this.helpers.configureApp(app, APP_EXTENSION)));\n      await helpers.installOtherApks(otherApps, this.adb, this.opts);\n    }\n\n    // install app\n    if (!this.opts.app) {\n      if (this.opts.fullReset) {\n        this.log.errorAndThrow('Full reset requires an app capability, use fastReset if app is not provided');\n      }\n      this.log.debug('No app capability. Assuming it is already on the device');\n      if (this.opts.fastReset) {\n        await helpers.resetApp(this.adb, this.opts);\n      }\n      return;\n    }\n    if (!this.opts.skipUninstall) {\n      await this.adb.uninstallApk(this.opts.appPackage);\n    }\n    await helpers.installApk(this.adb, this.opts);\n    const apkStringsForLanguage = await helpers.pushStrings(this.opts.language, this.adb, this.opts);\n    if (this.opts.language) {\n      this.apkStrings[this.opts.language] = apkStringsForLanguage;\n    }\n\n    // This must run after installing the apk, otherwise it would cause the\n    // install to fail. And before running the app.\n    if (!_.isUndefined(this.opts.sharedPreferences)) {\n      await this.setSharedPreferences(this.opts);\n    }\n  }\n\n  async checkAppPresent () {\n    this.log.debug('Checking whether app is actually present');\n    if (!(await fs.exists(this.opts.app))) {\n      this.log.errorAndThrow(`Could not find app apk at ${this.opts.app}`);\n    }\n  }\n\n  async checkPackagePresent () {\n    this.log.debug('Checking whether package is present on the device');\n    if (!(await this.adb.shell(['pm', 'list', 'packages', this.opts.appPackage]))) {\n      this.log.errorAndThrow(`Could not find package ${this.opts.appPackage} on the device`);\n    }\n  }\n\n  // Set CompressedLayoutHierarchy on the device\n  async setCompressedLayoutHierarchy (compress) {\n    await this.bootstrap.sendAction('compressedLayoutHierarchy', {compressLayout: compress});\n  }\n\n  async deleteSession () {\n    this.log.debug('Shutting down Android driver');\n\n    try {\n      if (!_.isEmpty(this._screenRecordingProperties)) {\n        await this.stopRecordingScreen();\n      }\n    } catch (ign) {}\n\n    await helpers.removeAllSessionWebSocketHandlers(this.server, this.sessionId);\n\n    await this.mobileStopScreenStreaming();\n\n    await super.deleteSession();\n\n    if (this.bootstrap) {\n      // certain cleanup we only care to do if the bootstrap was ever run\n      await this.stopChromedriverProxies();\n      if (this.opts.unicodeKeyboard && this.opts.resetKeyboard && this.defaultIME) {\n        this.log.debug(`Resetting IME to ${this.defaultIME}`);\n        await this.adb?.setIME(this.defaultIME);\n      }\n      if (!this.isChromeSession && !this.opts.dontStopAppOnReset) {\n        await this.adb?.forceStop(this.opts.appPackage);\n      }\n      await this.adb?.goToHome();\n      if (this.opts.fullReset && !this.opts.skipUninstall && !this.appOnDevice) {\n        await this.adb?.uninstallApk(this.opts.appPackage);\n      }\n      await this.bootstrap.shutdown();\n      this.bootstrap = null;\n    } else {\n      this.log.debug(\"Called deleteSession but bootstrap wasn't active\");\n    }\n    // some cleanup we want to do regardless, in case we are shutting down\n    // mid-startup\n    await this.adb?.stopLogcat();\n    if (this.useUnlockHelperApp) {\n      await this.adb?.forceStop('io.appium.unlock');\n    }\n    if (this._wasWindowAnimationDisabled) {\n      this.log.info('Restoring window animation state');\n      await this.adb?.setAnimationState(true);\n\n      // This was necessary to change animation scale over Android P. We must reset the policy for the security.\n      if (await this.adb?.getApiLevel() >= 28) {\n        this.log.info('Restoring hidden api policy to the device default configuration');\n        await this.adb?.setDefaultHiddenApiPolicy(!!this.opts.ignoreHiddenApiPolicyError);\n      }\n    }\n\n    if (this.opts.reboot) {\n      let avdName = this.opts.avd.replace('@', '');\n      this.log.debug(`closing emulator '${avdName}'`);\n      await this.adb?.killEmulator(avdName);\n    }\n  }\n\n  async setSharedPreferences () {\n    let sharedPrefs = this.opts.sharedPreferences;\n    this.log.info('Trying to set shared preferences');\n    let name = sharedPrefs.name;\n    if (_.isUndefined(name)) {\n      this.log.warn(`Skipping setting Shared preferences, name is undefined: ${JSON.stringify(sharedPrefs)}`);\n      return false;\n    }\n    let remotePath = `/data/data/${this.opts.appPackage}/shared_prefs`;\n    let remoteFile = `${remotePath}/${name}.xml`;\n    let localPath = `/tmp/${name}.xml`;\n    let builder = this.getPrefsBuilder();\n    builder.build(sharedPrefs.prefs);\n    this.log.info(`Creating temporary shared preferences: ${localPath}`);\n    builder.toFile(localPath);\n    this.log.info(`Creating shared_prefs remote folder: ${remotePath}`);\n    await this.adb.shell(['mkdir', '-p', remotePath]);\n    this.log.info(`Pushing shared_prefs to ${remoteFile}`);\n    await this.adb.push(localPath, remoteFile);\n    try {\n      this.log.info(`Trying to remove shared preferences temporary file`);\n      if (await fs.exists(localPath)) {\n        await fs.unlink(localPath);\n      }\n    } catch (e) {\n      this.log.warn(`Error trying to remove temporary file ${localPath}`);\n    }\n    return true;\n  }\n\n  getPrefsBuilder () {\n    /* Add this method to create a new SharedPrefsBuilder instead of\n     * directly creating the object on setSharedPreferences for testing purposes\n    */\n    return new SharedPrefsBuilder();\n  }\n\n  validateDesiredCaps (caps) {\n    if (!super.validateDesiredCaps(caps)) {\n      return false;\n    }\n    if ((!caps.browserName || !helpers.isChromeBrowser(caps.browserName)) && !caps.app && !caps.appPackage) {\n      this.log.errorAndThrow('The desired capabilities must include either an app, appPackage or browserName');\n    }\n    return helpers.validateDesiredCaps(caps);\n  }\n\n  proxyActive (sessionId) {\n    super.proxyActive(sessionId);\n\n    return this.jwpProxyActive;\n  }\n\n  getProxyAvoidList (sessionId) {\n    super.getProxyAvoidList(sessionId);\n\n    return this.jwpProxyAvoid;\n  }\n\n  canProxy (sessionId) {\n    super.canProxy(sessionId);\n\n    // this will change depending on ChromeDriver status\n    return _.isFunction(this.proxyReqRes);\n  }\n}\n\nexport { AndroidDriver };\nexport default AndroidDriver;\n"],"mappings":"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"}